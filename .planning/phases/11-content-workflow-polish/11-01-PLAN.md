---
phase: 11-content-workflow-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - /home/jc/notes/personal-vault/Templates/Post Template.md
  - src/content/blog/2026/hello-world.md
  - src/content.config.ts
autonomous: true

must_haves:
  truths:
    - "New posts from Obsidian template have title only in frontmatter, no H1 in body"
    - "Existing published posts display without redundant headings"
    - "Tags field exists in template with empty array default"
    - "Kepano-style fields pass through without breaking build"
  artifacts:
    - path: "/home/jc/notes/personal-vault/Templates/Post Template.md"
      provides: "Updated Obsidian post template"
      contains: "tags: []"
    - path: "src/content/blog/2026/hello-world.md"
      provides: "Fixed post without duplicate H1"
    - path: "src/content.config.ts"
      provides: "Schema with optional Kepano fields"
      contains: "categories"
  key_links:
    - from: "Post Template.md"
      to: "content.config.ts schema"
      via: "frontmatter fields match schema"
      pattern: "tags.*z\\.array"
---

<objective>
Fix template and content issues in the Obsidian-to-blog publishing workflow

Purpose: Eliminate title duplication bug and ensure tags work correctly for new and existing posts
Output: Updated Obsidian template without H1 body, fixed existing posts, schema accepts Kepano fields
</objective>

<execution_context>
@/home/jc/.claude/get-shit-done/workflows/execute-plan.md
@/home/jc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-content-workflow-polish/11-CONTEXT.md
@.planning/phases/11-content-workflow-polish/11-RESEARCH.md
@src/content.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Obsidian Post Template</name>
  <files>/home/jc/notes/personal-vault/Templates/Post Template.md</files>
  <action>
Update the Obsidian Post Template to:

1. Remove the `# <% tp.file.title %>` line from the body (title only in frontmatter)
2. Add `tags: []` field to frontmatter (prevents "others" default from schema)
3. Add `draft: true` as default (per user decision)
4. Keep all Kepano fields (categories, status, author, url, created, topics) for vault compatibility
5. Keep the Templater syntax for title and dates

The template should look like:
```markdown
---
title: <% tp.file.title %>
pubDatetime: <% tp.date.now("YYYY-MM-DDTHH:mm:ss.000ZZ") %>
description: ""
draft: true
tags: []
heroImage:
categories:
  - "[[Posts]]"
author:
  - "[[Me]]"
url:
created: <% tp.date.now("YYYY-MM-DD") %>
published:
topics: []
status:
  - Draft
---

[Your content here]
```

Note: Remove the H1 line entirely. Content starts after frontmatter.
  </action>
  <verify>
Read the updated template and confirm:
- No `# <% tp.file.title %>` line exists
- `tags: []` field is present in frontmatter
- `draft: true` field is present
- Kepano fields preserved (categories, status, etc.)
  </verify>
  <done>Template has no H1 in body, includes empty tags array, defaults to draft</done>
</task>

<task type="auto">
  <name>Task 2: Fix existing published posts and update schema</name>
  <files>src/content/blog/2026/hello-world.md, src/content.config.ts</files>
  <action>
Part A - Fix hello-world.md:
1. Remove the duplicate `# Hello World` line (line 16 currently)
2. Add `tags: []` to frontmatter if not present
3. Keep all other content and Kepano fields as-is

Part B - Update content.config.ts schema:
Add optional fields to accept Kepano-style frontmatter without breaking build:
```typescript
// Add after existing fields (line ~27):
// Kepano vault compatibility fields (pass-through)
categories: z.array(z.string()).optional(),
url: z.string().optional(),
created: z.coerce.date().optional(),
published: z.coerce.date().optional().nullable(),
topics: z.array(z.string()).optional(),
status: z.array(z.string()).optional(),
```

These fields pass through silently - they're not displayed on the blog but allow posts with Kepano metadata to build successfully.
  </action>
  <verify>
1. Run `npm run build` - should succeed
2. Check hello-world.md has no duplicate H1 (grep for "# Hello World")
3. Check content.config.ts has categories, status, etc. fields
  </verify>
  <done>Existing posts have no duplicate H1, schema accepts Kepano fields, build passes</done>
</task>

</tasks>

<verification>
1. Template validation:
   - `grep -c "^# " "/home/jc/notes/personal-vault/Templates/Post Template.md"` returns 0
   - `grep "tags: \[\]" "/home/jc/notes/personal-vault/Templates/Post Template.md"` finds match

2. Post validation:
   - `grep -c "^# Hello World" src/content/blog/2026/hello-world.md` returns 0

3. Build validation:
   - `npm run build` succeeds without errors

4. Schema validation:
   - `grep "categories" src/content.config.ts` finds the optional field
</verification>

<success_criteria>
- Obsidian template has no H1 in body, includes `tags: []` and `draft: true`
- hello-world.md has no duplicate H1 heading
- content.config.ts schema accepts Kepano fields
- `npm run build` passes
- Requirements TMPL-01, TMPL-02, TMPL-03 satisfied
- TMPL-04 satisfied: Obsidian YAML tags (`tags: [foo, bar]`) are already Astro-compatible (no conversion needed)
</success_criteria>

<output>
After completion, create `.planning/phases/11-content-workflow-polish/11-01-SUMMARY.md`
</output>

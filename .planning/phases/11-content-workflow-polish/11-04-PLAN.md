---
phase: 11-content-workflow-polish
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/hooks/blog-session-start.sh
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "SessionStart hook outputs JSON format for user visibility"
    - "User sees suggestion to run /blog:install when vault not configured"
    - "User sees post count notification when posts ready to publish"
  artifacts:
    - path: ".claude/hooks/blog-session-start.sh"
      provides: "JSON-formatted SessionStart hook output"
      contains: "hookSpecificOutput"
  key_links:
    - from: ".claude/hooks/blog-session-start.sh"
      to: "Claude Code UI"
      via: "hookSpecificOutput.additionalContext"
      pattern: "additionalContext"
---

<objective>
Fix SessionStart hook to use JSON output format for user-visible messages

Purpose: Plain stdout from SessionStart hooks goes to Claude's context but is not displayed to users. Claude Code requires JSON output with `hookSpecificOutput.additionalContext` for messages to appear in the user interface.

Output: Updated hook script that outputs proper JSON format so users see actionable suggestions.
</objective>

<execution_context>
@/home/jc/.claude/get-shit-done/workflows/execute-plan.md
@/home/jc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Gap source: `.planning/phases/11-content-workflow-polish/11-UAT.md` - Test 6 failed
Root cause: SessionStart hook stdout goes to Claude's context, not user terminal. Claude Code requires JSON output with hookSpecificOutput.additionalContext for user visibility.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update hook to output JSON format</name>
  <files>.claude/hooks/blog-session-start.sh</files>
  <action>
Update the blog-session-start.sh hook to output JSON with hookSpecificOutput.additionalContext instead of plain echo statements.

The JSON format for SessionStart hooks is:
```json
{
  "hookSpecificOutput": {
    "hookEventName": "SessionStart",
    "additionalContext": "Your message here"
  }
}
```

Changes needed:
1. Replace plain `echo` for vault not configured message with JSON output containing the suggestion
2. Replace plain `echo` for posts ready message with JSON output containing the post count
3. When there's nothing to report, output nothing (exit 0 silently) - no JSON needed for the success case
4. Use `jq -n` to construct valid JSON safely (handles escaping)

Key behaviors to preserve:
- Check if vault is configured via `.claude/settings.local.json`
- Count posts with "Published" status in vault
- Exit 0 in all cases (non-blocking hook)

Message content to preserve:
- Vault not configured: "Obsidian vault not configured. Run /blog:install to set up."
- Posts ready: "Ready: N post(s) with Published status. Run /blog:publish to continue."
  </action>
  <verify>
1. Run the hook manually with test scenarios:
   - Without settings.local.json: should output JSON with install suggestion
   - With configured vault and posts: should output JSON with post count
   - With configured vault and no posts: should output nothing

```bash
# Test 1: No config file
rm -f /tmp/test-settings.local.json
CLAUDE_PROJECT_DIR=/tmp ./.claude/hooks/blog-session-start.sh

# Test 2: With real config (if vault configured)
./.claude/hooks/blog-session-start.sh
```

2. Validate JSON output with jq:
```bash
./.claude/hooks/blog-session-start.sh | jq .
```
  </verify>
  <done>Hook outputs valid JSON with hookSpecificOutput.additionalContext for user-visible messages, or nothing when there's no actionable information.</done>
</task>

</tasks>

<verification>
1. Hook outputs valid JSON when vault not configured
2. Hook outputs valid JSON when posts are ready to publish
3. Hook outputs nothing when vault is configured but no posts ready
4. All JSON output validates with `jq .`
5. Messages contain same actionable text as before (just formatted differently)
</verification>

<success_criteria>
- SessionStart hook uses JSON format with hookSpecificOutput.additionalContext
- User-visible suggestions appear in Claude Code UI when appropriate
- Hook remains non-blocking (always exits 0)
- UAT Test 6 passes on re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/11-content-workflow-polish/11-04-SUMMARY.md`
</output>

---
phase: 11-content-workflow-polish
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/hooks/blog-session-start.sh
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User sees message in terminal UI when vault not configured"
    - "User sees message in terminal UI when posts are ready to publish"
    - "Claude also receives context for informed responses"
  artifacts:
    - path: ".claude/hooks/blog-session-start.sh"
      provides: "SessionStart hook with dual output (user + Claude)"
      contains: "systemMessage"
  key_links:
    - from: ".claude/hooks/blog-session-start.sh"
      to: "Terminal UI"
      via: "systemMessage JSON field"
      pattern: "systemMessage"
    - from: ".claude/hooks/blog-session-start.sh"
      to: "Claude context"
      via: "hookSpecificOutput.additionalContext"
      pattern: "additionalContext"
---

<objective>
Fix SessionStart hook to display messages in user's terminal UI

Purpose: Previous fix (11-04) used `additionalContext` which adds to Claude's context but does not display to users in the terminal. Claude Code uses `systemMessage` for user-visible warnings. The hook needs both fields.

Output: Updated hook script that outputs `systemMessage` for user visibility AND `additionalContext` for Claude context.
</objective>

<execution_context>
@/home/jc/.claude/get-shit-done/workflows/execute-plan.md
@/home/jc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Gap source: `.planning/phases/11-content-workflow-polish/11-UAT.md` - Test 6 still failing after 11-04
Root cause: `additionalContext` goes to Claude's context (system-reminder), not terminal UI. Claude Code uses `systemMessage` field for user-visible warnings.
Fix approach: Output both `systemMessage` (user) AND `additionalContext` (Claude).
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add systemMessage field for user visibility</name>
  <files>.claude/hooks/blog-session-start.sh</files>
  <action>
Update blog-session-start.sh to output BOTH fields in the JSON:

1. `systemMessage` - User-visible warning displayed in terminal UI
2. `hookSpecificOutput.additionalContext` - Context added for Claude

The JSON format should be:
```json
{
  "systemMessage": "Your message here",
  "hookSpecificOutput": {
    "hookEventName": "SessionStart",
    "additionalContext": "Your message here"
  }
}
```

Update the two jq commands in the script:

For vault not configured case (line 9):
```bash
jq -n --arg msg "Obsidian vault not configured. Run /blog:install to set up." \
    '{systemMessage: $msg, hookSpecificOutput: {hookEventName: "SessionStart", additionalContext: $msg}}'
```

For posts ready case (lines 25-26):
```bash
jq -n --arg msg "Ready: $POST_COUNT post(s) with Published status. Run /blog:publish to continue." \
    '{systemMessage: $msg, hookSpecificOutput: {hookEventName: "SessionStart", additionalContext: $msg}}'
```

Also update the comment at line 3 to reflect the dual output:
```bash
# Outputs JSON with systemMessage (user-visible) and hookSpecificOutput.additionalContext (Claude context)
```

Key behaviors to preserve:
- Check vault config via `.claude/settings.local.json`
- Count posts with "Published" status using existing perl pattern
- Exit 0 in all cases (non-blocking hook)
- Silent exit when vault configured but no posts ready
  </action>
  <verify>
1. Test JSON output manually:
```bash
# Test with no config - should show systemMessage
rm -f /tmp/test-settings.local.json
CLAUDE_PROJECT_DIR=/tmp ./.claude/hooks/blog-session-start.sh | jq .

# Verify both fields present
CLAUDE_PROJECT_DIR=/tmp ./.claude/hooks/blog-session-start.sh | jq -e '.systemMessage and .hookSpecificOutput.additionalContext'
```

2. Test with real environment (if vault configured with Published posts):
```bash
./.claude/hooks/blog-session-start.sh | jq .
```

3. Verify JSON is valid:
```bash
CLAUDE_PROJECT_DIR=/tmp ./.claude/hooks/blog-session-start.sh | jq -e type
```
  </verify>
  <done>Hook outputs JSON with both systemMessage (for terminal UI) and additionalContext (for Claude context). User sees actionable suggestions in their terminal when starting a session.</done>
</task>

</tasks>

<verification>
1. Hook outputs valid JSON with both `systemMessage` and `additionalContext` fields
2. Fields contain identical message content
3. JSON validates with `jq -e type`
4. Hook still exits 0 in all cases
5. Silent exit when nothing to report (vault configured, no posts ready)
</verification>

<success_criteria>
- SessionStart hook outputs `systemMessage` for user visibility in terminal UI
- SessionStart hook also outputs `additionalContext` for Claude context
- Messages are actionable: tell user what to run (/blog:install or /blog:publish)
- UAT Test 6 passes on re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/11-content-workflow-polish/11-05-SUMMARY.md`
</output>

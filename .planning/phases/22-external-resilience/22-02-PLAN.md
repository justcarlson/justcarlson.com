---
phase: 22-external-resilience
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [src/components/GitHubChart.astro]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "GitHub chart remains visible after successful load (cached or fresh)"
    - "No timeout triggers when image already loaded"
    - "Loading shimmer removed immediately for cached images"
  artifacts:
    - path: "src/components/GitHubChart.astro"
      provides: "Early-exit logic for already-loaded images"
      contains: "img.complete && img.naturalHeight"
  key_links:
    - from: "setupGitHubChartFallback()"
      to: "img.complete check"
      via: "early return before timeout"
      pattern: "img\\.complete.*naturalHeight"
---

<objective>
Fix GitHub chart disappearing after 5 seconds when image is cached or loads before script runs.

Purpose: The current implementation sets a 5-second timeout unconditionally. When the image is cached or loads instantly, the `onload` event has already fired before the script attaches its handler, so the timeout eventually triggers the fallback even though the image loaded successfully.

Output: GitHubChart.astro with early-exit check for already-loaded images.
</objective>

<execution_context>
@/home/jc/.claude/get-shit-done/workflows/execute-plan.md
@/home/jc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-external-resilience/22-UAT.md

@src/components/GitHubChart.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add early-exit check for already-loaded images</name>
  <files>src/components/GitHubChart.astro</files>
  <action>
In `setupGitHubChartFallback()`, immediately after the `if (!img || !container) return;` check, add:

```javascript
// If image already loaded (cached), remove loading state and exit
if (img.complete && img.naturalHeight > 0) {
  container.classList.remove('img-loading');
  return;
}
```

This check MUST come BEFORE the timeout is set. The logic:
- `img.complete` is true when the image has finished loading (or failed)
- `img.naturalHeight > 0` confirms it loaded successfully (failed images have naturalHeight of 0)
- If both true, the image is already displayed - remove shimmer and return early
- No timeout, no event handlers needed - image is already visible

Do NOT modify any other logic. The existing timeout/onload/onerror logic remains unchanged for fresh loads.
  </action>
  <verify>
1. `grep -n "img.complete && img.naturalHeight" src/components/GitHubChart.astro` shows the check exists
2. Run `npm run build` - build succeeds
3. Manual test: Load about page, chart appears, wait 10 seconds, chart still visible
4. Manual test: Refresh page (cached), chart appears immediately and stays visible
  </verify>
  <done>
- Cached images display immediately without shimmer
- Chart remains visible indefinitely after loading (no 5-second disappearance)
- Fresh loads still show shimmer and timeout fallback works if blocked
  </done>
</task>

</tasks>

<verification>
After fix:
1. Fresh load (empty cache): shimmer shows, chart appears when loaded, stays visible
2. Cached load (refresh): chart appears instantly, no shimmer, stays visible
3. Blocked image: shimmer shows for 5 seconds, then fallback link appears

Run: `npm run dev` and test on /about page
</verification>

<success_criteria>
- GitHub contribution chart remains visible indefinitely after successful load
- Works correctly for both cached and fresh image loads
- Fallback still works when image is blocked
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/22-external-resilience/22-02-SUMMARY.md`
</output>

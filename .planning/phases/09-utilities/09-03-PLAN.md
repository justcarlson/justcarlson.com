---
phase: 09-utilities
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/list-posts.sh
  - scripts/unpublish.sh
  - .planning/ROADMAP.md
  - .planning/phases/08-core-publishing/.continue-here.md
  - .planning/research/SUMMARY.md
  - .planning/research/ARCHITECTURE.md
  - .planning/research/FEATURES.md
  - .planning/research/07-STACK.md
  - .planning/research/PITFALLS.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "--published flag shows posts directly from blog directory"
    - "User cancellation exits with code 0"
    - "ANSI escape codes display as colors in unpublish tip"
    - "Documentation uses status: - Published terminology"
  artifacts:
    - path: "scripts/list-posts.sh"
      provides: "Direct blog scan for --published mode"
      contains: "list_published_posts"
    - path: "scripts/unpublish.sh"
      provides: "Clean exit on cancellation"
      contains: "exit $EXIT_SUCCESS"
  key_links:
    - from: "scripts/list-posts.sh"
      to: "src/content/blog"
      via: "direct find when --published"
      pattern: "find.*BLOG_DIR.*-name"
---

<objective>
Fix 4 gaps identified during UAT testing of Phase 9 utilities.

Purpose: Resolve minor issues that affect usability and consistency.
Output: Working --published flag, clean cancellation, proper ANSI display, consistent terminology.
</objective>

<execution_context>
@/home/jc/.claude/get-shit-done/workflows/execute-plan.md
@/home/jc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/09-utilities/09-01-SUMMARY.md
@.planning/phases/09-utilities/09-02-SUMMARY.md
@.planning/phases/09-utilities/09-UAT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix script issues (list-posts --published and unpublish)</name>
  <files>
    scripts/list-posts.sh
    scripts/unpublish.sh
  </files>
  <action>
**list-posts.sh --published mode:**

The current implementation scans Obsidian vault first, then filters by blog presence. This fails when blog posts don't have matching source files with Published status.

Add a separate function `list_published_posts()` that scans `src/content/blog/` directly:

1. Create `list_published_posts()` function:
   - Use `find "$BLOG_DIR" -name "*.md" -type f` to get all blog posts
   - Extract title, date from each file's frontmatter
   - No validation needed (already published = already valid)
   - Display in same table format as other modes

2. In `list_posts()` function, at the start:
   - If `FILTER_MODE="published"`, call `list_published_posts` and return
   - Existing logic remains for "all" and "unpublished" modes

**unpublish.sh fixes:**

1. Line 222: Change `exit $EXIT_CANCELLED` to `exit $EXIT_SUCCESS`
   - User cancellation is a valid outcome, not an error
   - Exit code 130 causes justfile to show error message

2. Line 261: Change `echo` to `echo -e`
   - Current: `echo "    - Draft  ${CYAN}(or remove - Published)${RESET}"`
   - Should be: `echo -e "    - Draft  ${CYAN}(or remove - Published)${RESET}"`
   - Matches all other color-printing statements in the script
  </action>
  <verify>
Test --published mode:
```bash
just list-posts --published
```
Should show posts from src/content/blog/ even if Obsidian source missing.

Test cancellation:
```bash
echo "n" | just unpublish some-post 2>/dev/null; echo "Exit code: $?"
```
Should show "Exit code: 0" (not 130).

Test ANSI display:
```bash
# Look at the tip output after running unpublish (or check source)
grep -n 'echo.*Draft.*CYAN' scripts/unpublish.sh
```
Should show `echo -e` not `echo`.
  </verify>
  <done>
- `just list-posts --published` shows blog posts directly
- Cancellation exits with code 0
- ANSI tip displays with colors
  </done>
</task>

<task type="auto">
  <name>Task 2: Update documentation terminology</name>
  <files>
    .planning/ROADMAP.md
    .planning/phases/08-core-publishing/.continue-here.md
    .planning/research/SUMMARY.md
    .planning/research/ARCHITECTURE.md
    .planning/research/FEATURES.md
    .planning/research/07-STACK.md
    .planning/research/PITFALLS.md
  </files>
  <action>
Update all references to old `draft: false/true` terminology to new `status: - Published/Draft` format.

**Specific changes:**

1. `.planning/ROADMAP.md` line 67:
   - FROM: `draft: false`
   - TO: `status: - Published`

2. `.planning/phases/08-core-publishing/.continue-here.md` line 29:
   - FROM: `draft: false` ... `draft: true`
   - TO: `status: - Published` ... `status: - Draft`

3. `.planning/research/SUMMARY.md` line 39:
   - FROM: `draft: false`
   - TO: `status: - Published`

4. `.planning/research/ARCHITECTURE.md` lines 167, 296:
   - FROM: `draft: false`
   - TO: `status: - Published`

5. `.planning/research/FEATURES.md` lines 19, 27, 142, 200:
   - FROM: `draft: false`
   - TO: `status: - Published`

6. `.planning/research/07-STACK.md` lines 42, 244:
   - FROM: `draft: false`
   - TO: `status: - Published`

7. `.planning/research/PITFALLS.md` lines 470, 480, 483:
   - FROM: `draft: true`/`draft: false`
   - TO: `status: - Draft`/`status: - Published`
   - Update the grep example to show proper multiline matching

Note: Do NOT modify files in .planning/phases/04-content-polish/ or .planning/quick/ - those are historical records of v0.1.0 work before the status field change.
  </action>
  <verify>
```bash
# Should return only UAT.md (the gap report itself)
grep -r "draft: false" .planning/ROADMAP.md .planning/research/ .planning/phases/08-core-publishing/.continue-here.md
```
No matches in updated files.
  </verify>
  <done>
- All v0.2.0 documentation uses `status: - Published` terminology
- v0.1.0 historical docs remain unchanged
  </done>
</task>

</tasks>

<verification>
```bash
# Test --published mode with real blog posts
just list-posts --published

# Verify cancellation exit code
(echo "n" | just unpublish fake-post 2>/dev/null || true); echo "Exit: $?"

# Verify ANSI escape flag
grep -c 'echo -e.*CYAN' scripts/unpublish.sh | grep -q '[3-9]' && echo "ANSI OK"

# Verify documentation updated
grep -l "draft: false" .planning/ROADMAP.md .planning/research/*.md .planning/phases/08-core-publishing/.continue-here.md 2>/dev/null && echo "FAIL: old terminology found" || echo "PASS: terminology updated"
```
</verification>

<success_criteria>
- `just list-posts --published` shows posts from blog directory
- `just unpublish` cancellation exits with code 0
- ANSI tip in unpublish displays colored text
- Documentation uses `status: - Published` not `draft: false`
</success_criteria>

<output>
After completion, create `.planning/phases/09-utilities/09-03-SUMMARY.md`
</output>

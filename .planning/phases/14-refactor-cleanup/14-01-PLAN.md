---
phase: 14-refactor-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - knip.json
  - src/components/Breadcrumb.astro
  - src/components/ThemeToggle.astro
  - src/components/SocialIcons.astro
  - src/components/HeaderLink.astro
  - src/layouts/BaseLayout.astro
  - src/layouts/BlogPost.astro
autonomous: true

must_haves:
  truths:
    - "Knip reports no unused exports in src/"
    - "Build succeeds after dead code removal"
    - "No orphaned components remain in codebase"
  artifacts:
    - path: "knip.json"
      provides: "Knip configuration for Astro project"
      contains: "schema.*knip"
    - path: "package.json"
      provides: "Knip dev dependency and script"
      contains: "knip"
  key_links:
    - from: "package.json"
      to: "knip.json"
      via: "npm run knip reads config"
      pattern: '"knip":'
---

<objective>
Run Knip dead code analysis and remove confirmed unused components and layouts.

Purpose: Eliminate dead code to reduce maintenance burden and confusion. Research identified several components (Breadcrumb, ThemeToggle, SocialIcons, HeaderLink) and layouts (BaseLayout, BlogPost) with no imports.

Output: Clean codebase with Knip tooling, all unused files removed, build verified.
</objective>

<execution_context>
@/home/jc/.claude/get-shit-done/workflows/execute-plan.md
@/home/jc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-refactor-cleanup/14-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Knip and configure for Astro</name>
  <files>package.json, knip.json</files>
  <action>
Install Knip as a dev dependency:
```bash
npm install -D knip
```

Add knip script to package.json scripts section:
```json
"knip": "knip"
```

Create knip.json with Astro-aware configuration:
```json
{
  "$schema": "https://unpkg.com/knip@5/schema.json",
  "entry": [
    "src/pages/**/*.{astro,ts}",
    "src/content.config.ts"
  ],
  "project": ["src/**/*.{astro,ts,tsx,js,mjs}"],
  "ignore": ["src/env.d.ts"],
  "ignoreDependencies": ["@types/node"]
}
```

Run `npx knip` and capture the unused exports report. This will be the definitive list for removal.

Do NOT remove any files in this task - just setup Knip and analyze.
  </action>
  <verify>
- `npx knip` runs without errors
- Report shows candidate unused exports
- knip.json exists with Astro configuration
  </verify>
  <done>Knip installed, configured, and produces unused export report</done>
</task>

<task type="auto">
  <name>Task 2: Remove confirmed dead components and layouts</name>
  <files>
src/components/Breadcrumb.astro
src/components/ThemeToggle.astro
src/components/SocialIcons.astro
src/components/HeaderLink.astro
src/layouts/BaseLayout.astro
src/layouts/BlogPost.astro
  </files>
  <action>
Using Knip output from Task 1, delete files that are confirmed unused.

**Expected deletions based on research (verify with Knip first):**
- `src/components/Breadcrumb.astro` - No imports found
- `src/components/ThemeToggle.astro` - No imports found
- `src/components/SocialIcons.astro` - No imports found
- `src/components/HeaderLink.astro` - No imports found
- `src/layouts/BaseLayout.astro` - No imports found (replaced by Layout.astro)
- `src/layouts/BlogPost.astro` - No imports found (replaced by BlogPostLayout.astro)

**IMPORTANT:** Before deleting each file:
1. Grep for any imports of the component/layout
2. Check for dynamic imports via glob patterns
3. Verify Knip reports it as unused

If Knip shows a file as USED that research suggested was unused, DO NOT delete it. Trust Knip over grep analysis - Knip handles transitive dependencies.

After deletions, run:
```bash
npm run build
```
to verify no breakage.
  </action>
  <verify>
- `npm run build` succeeds
- Deleted files are gone from src/components/ and src/layouts/
- `npx knip` shows reduced or no unused exports
  </verify>
  <done>All confirmed dead code removed, build passes</done>
</task>

<task type="auto">
  <name>Task 3: Commit cleanup changes</name>
  <files>N/A (git operation)</files>
  <action>
Stage and commit the cleanup:

```bash
git add -A
git commit -m "chore(14): remove dead components and layouts

Knip analysis confirmed these files had no imports:
- Breadcrumb.astro, ThemeToggle.astro, SocialIcons.astro, HeaderLink.astro
- BaseLayout.astro, BlogPost.astro (replaced by Layout.astro, BlogPostLayout.astro)

Added Knip for ongoing dead code detection."
```
  </action>
  <verify>
- `git log -1` shows commit message
- `git status` shows clean working tree
  </verify>
  <done>Dead code removal committed</done>
</task>

</tasks>

<verification>
1. `npx knip` runs and shows minimal/no issues
2. `npm run build` succeeds
3. `git status` is clean
4. Deleted files no longer exist in codebase
</verification>

<success_criteria>
- Knip installed and configured (knip.json exists)
- All confirmed dead components removed (0 unused component files)
- Build passes after cleanup
- Changes committed
</success_criteria>

<output>
After completion, create `.planning/phases/14-refactor-cleanup/14-01-SUMMARY.md`
</output>

---
phase: 14-refactor-cleanup
plan: 02
type: execute
wave: 2
depends_on: [14-01]
files_modified:
  - src/consts.ts
  - src/constants.ts
  - src/config.ts
  - src/components/Socials.astro
autonomous: true

must_haves:
  truths:
    - "Single source of truth for site configuration (consts.ts)"
    - "SOCIALS and SOCIAL_LINKS consolidated to one export"
    - "All imports resolve correctly after consolidation"
    - "CLI scripts pass verification (--help works, non-interactive mode works)"
  artifacts:
    - path: "src/consts.ts"
      provides: "Consolidated configuration including SHARE_LINKS"
      exports: ["SITE", "SOCIAL_LINKS", "SHARE_LINKS", "NAV_LINKS", "ICON_MAP", "NEWSLETTER_CONFIG"]
  key_links:
    - from: "src/components/Socials.astro"
      to: "src/consts.ts"
      via: "import { SOCIALS }"
      pattern: 'from.*consts'
    - from: "src/components/ShareLinks.astro"
      to: "src/consts.ts"
      via: "import { SHARE_LINKS }"
      pattern: 'from.*consts'
---

<objective>
Consolidate constants files and verify CLI compliance.

Purpose: Eliminate configuration duplication (SOCIALS vs SOCIAL_LINKS) and verify all success criteria for Phase 14 are met (CLI --help, non-interactive mode, no dead code).

Output: Single source of truth for constants, verified CLI compliance, phase complete.
</objective>

<execution_context>
@/home/jc/.claude/get-shit-done/workflows/execute-plan.md
@/home/jc/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-refactor-cleanup/14-RESEARCH.md
@.planning/phases/14-refactor-cleanup/14-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Consolidate constants files</name>
  <files>src/consts.ts, src/constants.ts, src/config.ts, src/components/Socials.astro, src/components/ShareLinks.astro</files>
  <action>
**Current state:**
- `consts.ts`: SITE, NAV_LINKS, SOCIAL_LINKS, ICON_MAP, NEWSLETTER_CONFIG
- `constants.ts`: SOCIALS (duplicate of SOCIAL_LINKS with different shape), SHARE_LINKS
- `config.ts`: Re-exports both (compatibility layer)

**Target state:**
- `consts.ts`: All configuration (add SHARE_LINKS, keep SOCIALS for backward compat)
- `constants.ts`: DELETE
- `config.ts`: Simple re-export of consts.ts only

**Step 1:** Add SHARE_LINKS to consts.ts (copy from constants.ts).

**Step 2:** Add SOCIALS to consts.ts (copy from constants.ts) to maintain backward compatibility with Socials.astro. The SOCIALS array has a different shape than SOCIAL_LINKS (includes `name`, `linkTitle`, `icon`, `active` vs just `href`, `label`), so both need to exist.

**Step 3:** Update `src/components/Socials.astro`:
Change: `import { SOCIALS } from "@/constants";`
To: `import { SOCIALS } from "@/consts";`

**Step 4:** Update `src/components/ShareLinks.astro`:
Change: `import { SHARE_LINKS } from "@/constants";`
To: `import { SHARE_LINKS } from "@/consts";`

**Step 5:** Delete `src/constants.ts`

**Step 6:** Simplify `src/config.ts` to:
```typescript
// Re-export everything from consts.ts for compatibility
export * from "./consts";
```

**Step 7:** Run build to verify no broken imports:
```bash
npm run build
```
  </action>
  <verify>
- `npm run build` succeeds
- `src/constants.ts` no longer exists
- `grep -r "from.*constants" src/` returns no matches
- All imports resolve to consts.ts
  </verify>
  <done>Constants consolidated to single source of truth</done>
</task>

<task type="auto">
  <name>Task 2: Verify CLI compliance and final Knip check</name>
  <files>N/A (verification only)</files>
  <action>
Run comprehensive verification of all Phase 14 success criteria:

**1. CLI --help verification (CLIX-01):**
```bash
scripts/publish.sh --help
scripts/setup.sh --help
scripts/list-posts.sh --help
scripts/unpublish.sh --help
scripts/bootstrap.sh --help
```
All must output help text and exit 0.

**2. Non-interactive mode verification (CLIX-02, CLIX-03):**
```bash
# Test setup.sh with explicit vault (should work without TTY)
scripts/setup.sh --vault /tmp/test-vault 2>&1 | head -5

# Test publish.sh dry-run with --all (non-interactive)
scripts/publish.sh --dry-run --all 2>&1 | head -10
```
Both must work without hanging for input.

**3. Dead code check (CLEAN-01):**
```bash
npx knip
```
Should report minimal/no issues after cleanup.

**4. Build verification:**
```bash
npm run build
```
Must succeed.

If any check fails, note it for resolution. Otherwise, all success criteria are verified.
  </action>
  <verify>
- All 5 scripts respond to --help
- Non-interactive mode works (setup --vault, publish --all --yes)
- `npx knip` shows no critical unused exports
- `npm run build` succeeds
  </verify>
  <done>All Phase 14 success criteria verified</done>
</task>

<task type="auto">
  <name>Task 3: Commit consolidation and finalize</name>
  <files>N/A (git operation)</files>
  <action>
Stage and commit the constants consolidation:

```bash
git add -A
git commit -m "refactor(14): consolidate constants to single source of truth

- Move SHARE_LINKS and SOCIALS from constants.ts to consts.ts
- Update Socials.astro and ShareLinks.astro imports
- Delete constants.ts (no longer needed)
- Simplify config.ts to re-export consts.ts only

All Phase 14 success criteria verified:
- CLI --help: all scripts compliant
- Non-interactive mode: publish/setup work without TTY
- Dead code: removed via Knip analysis
- Constants: consolidated to consts.ts"
```
  </action>
  <verify>
- `git log -1` shows commit message
- `git status` shows clean working tree
  </verify>
  <done>Phase 14 complete - constants consolidated, all criteria verified</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `grep -r "from.*constants" src/` returns empty (all migrated)
3. `npx knip` shows no critical issues
4. All scripts respond to `--help`
5. `scripts/setup.sh --vault /tmp/test` works without TTY
</verification>

<success_criteria>
- constants.ts deleted
- All imports use consts.ts (via @/config or @/consts)
- CLI --help works on all scripts
- Non-interactive mode works
- Build passes
- Knip shows no critical unused exports
</success_criteria>

<output>
After completion, create `.planning/phases/14-refactor-cleanup/14-02-SUMMARY.md`
</output>
